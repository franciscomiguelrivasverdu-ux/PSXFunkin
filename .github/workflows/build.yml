name: Build PSXFunkin

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
        
    - name: Install PSX toolchain
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential git make wget
        wget -O ps1dev.tar.gz https://github.com/psxdev/ps1-prefab/archive/refs/heads/main.tar.gz
        tar -xf ps1dev.tar.gz
        echo "$(pwd)/ps1-prefab-main/toolchain/mipsel-none-elf/bin" >> $GITHUB_PATH
        
    - name: Build complete project
      run: |
        make
        
    - name: Upload PSX build
      uses: actions/upload-artifact@v4
      with:
        name: psx-game
        path: "*.bin"
        retention-days: 30
