name: Generate Sprite Metadata

on:
  push:
    branches: [ master ]
    paths:
      - 'iso/chart/**/*.png'
  workflow_dispatch:

jobs:
  metadata:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Install ImageMagick
      run: |
        sudo apt-get update
        sudo apt-get install -y imagemagick
        
    - name: Generate metadata files
      run: |
        echo "ğŸ“ GENERANDO ARCHIVOS .TXT AUTOMÃTICAMENTE..."
        find iso/chart -name "*.png" | while read png_file; do
          txt_file="${png_file}.txt"
          
          # Obtener dimensiones de la imagen
          dimensions=$(identify -format "%w %h" "$png_file")
          width=$(echo $dimensions | cut -d' ' -f1)
          height=$(echo $dimensions | cut -d' ' -f2)
          
          # Calcular frames (asumimos 2 frames horizontales)
          frame_width=$((width / 2))
          num_frames=2
          
          # Generar metadata
          echo "$frame_width 0 0 $height $num_frames" > "$txt_file"
          echo "âœ… Generado: $txt_file â†’ $frame_width 0 0 $height $num_frames"
        done
        
    - name: List generated files
      run: |
        echo "ğŸ“ ARCHIVOS .TXT GENERADOS:"
        find iso/chart -name "*.png.txt"
        
    - name: Upload metadata
      uses: actions/upload-artifact@v4
      with:
        name: sprite-metadata
        path: iso/chart/**/*.png.txt
